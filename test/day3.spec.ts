import { expect } from 'chai';
import * as fs from 'fs';


describe('day 3', () => {
  function parseReport(rawReport: string[]): number[][] {
    let report: number[][] = [];
    rawReport.sort().forEach(x => {
      x.split('').forEach((v, k) => {
        if (!report[k]) report[k] = [];
        report[k].push(parseInt(v));
      })
    })
    return report;
  }

  let example = [
    0b00010,
    0b00100,
    0b00111,
    0b01010,
    0b01111,
    0b10000,
    0b10101,
    0b10110,
    0b10111,
    0b11001,
    0b11100,
    0b11110,
  ];
  const real = [0b000110000001,0b011011001101,0b001101100111,0b001101011001,0b110111011101,0b110011101010,0b111101010001,0b010100111101,0b011000011000,0b001110110011,0b001100010110,0b110111101100,0b110001111100,0b001011111100,0b000000011010,0b110101100111,0b011000011111,0b011000000111,0b011111000110,0b100101110111,0b010101001110,0b111101000011,0b010010010110,0b100100011111,0b101011001110,0b001111110000,0b110000011111,0b110000011000,0b011001111100,0b010010001101,0b000111001110,0b110111001110,0b110001010101,0b100111011001,0b000101110000,0b110001011100,0b111101010010,0b101011000001,0b001101001111,0b110111101010,0b101111111000,0b110101000110,0b011111001001,0b001110100001,0b010100110111,0b110100000110,0b101010110010,0b100100101110,0b101111011110,0b000110110101,0b011011110101,0b111001011110,0b110110100111,0b000100010001,0b001101010110,0b100011000110,0b001110010010,0b010111110111,0b011010011101,0b110000011100,0b010100001001,0b000110100000,0b101001010000,0b000001110000,0b101110010011,0b010011100111,0b010011011000,0b110111011111,0b000111010010,0b101010111010,0b111001100100,0b101110100011,0b111101111110,0b010111111000,0b010010001111,0b110010000011,0b001110000010,0b100101111110,0b000100101001,0b101101010000,0b111111010000,0b101010011000,0b011100100001,0b011101101000,0b001010010100,0b010010100011,0b110011111111,0b110100011001,0b111010011110,0b011110001101,0b011010011100,0b100100000001,0b111111001010,0b110100110011,0b110100011111,0b100010001110,0b101000111100,0b100001110010,0b110101010011,0b101010011101,0b011010011010,0b101110101101,0b001100011010,0b101001010101,0b101010000100,0b000110101010,0b100000111100,0b000111111100,0b000001001011,0b010010111100,0b011000111001,0b111010101100,0b010011100010,0b010100110001,0b001100111011,0b101100001111,0b111010101111,0b010001000011,0b000001100010,0b000100001011,0b100110011011,0b101100001110,0b000010110100,0b011000101011,0b010011011100,0b110101010000,0b101101101100,0b101001110000,0b010111010011,0b110101110001,0b011000001000,0b011101010010,0b111011111110,0b010010000110,0b110000111000,0b101000000110,0b011100110000,0b111001111010,0b110000001100,0b101011111110,0b100001111100,0b011011100110,0b101000001101,0b001011110011,0b111100100011,0b101111000111,0b101000000001,0b001001011010,0b010111111010,0b101010111001,0b011110101001,0b101100111101,0b011100000010,0b000110001111,0b111100110101,0b100011100010,0b000110010100,0b011000000011,0b010011001011,0b000001101111,0b101011101101,0b100100100101,0b011001110110,0b010100000000,0b100100010001,0b001100000100,0b100000111010,0b101001011001,0b010010111001,0b110000101010,0b001101010101,0b110110011100,0b010000000011,0b111100011000,0b000101111110,0b100010110101,0b101111010000,0b000010100010,0b101101001010,0b011111000000,0b011000100100,0b110010100110,0b010001110011,0b010101101101,0b001011100000,0b001000110110,0b001000110111,0b110100111110,0b110010110100,0b101010100111,0b000111011001,0b111000101101,0b110000010110,0b010011101010,0b110100111011,0b100110010100,0b100111000011,0b011110111111,0b010010000111,0b111100111110,0b001010111101,0b000011001110,0b000110010101,0b111100110011,0b101111111001,0b101001111011,0b111010110000,0b000001010101,0b100010011001,0b111110110010,0b110100101100,0b100001011110,0b100001000011,0b101111000011,0b101111110100,0b111010000010,0b001010010110,0b010001000110,0b100010000101,0b111101111010,0b000101111111,0b010110110100,0b110111111110,0b011010101011,0b100000110011,0b000000101001,0b010010101111,0b010001001010,0b000101010100,0b101110111010,0b101001000000,0b001010101111,0b011110100110,0b110101011001,0b100111101101,0b110001001001,0b110100001010,0b100100101001,0b110111010011,0b011010001011,0b011001001101,0b110100010001,0b010100001100,0b011011000001,0b110100011100,0b001110111111,0b111001110010,0b001110010000,0b011100001110,0b001111110001,0b001101010111,0b111110011100,0b111100111010,0b010100010100,0b000011001010,0b011110001010,0b111101010011,0b100111001010,0b010110110011,0b000101000000,0b000110011010,0b100100001111,0b000100111111,0b010100010101,0b001110100011,0b100111000100,0b100001101110,0b011010011110,0b001111010101,0b111000001100,0b100111110110,0b101110001100,0b101011000111,0b001010110010,0b100011011100,0b110000010000,0b101001101011,0b111011011000,0b000101101001,0b011001111011,0b101011001111,0b001111111111,0b110000101011,0b111111100011,0b101010101111,0b001001010001,0b011111010001,0b001011101110,0b011010011011,0b011000001011,0b100000100000,0b001011110110,0b011000100011,0b001010011010,0b000010111111,0b001110001111,0b111110001100,0b010110100011,0b110101100010,0b100111110000,0b010000101011,0b011100011111,0b001100101010,0b101110110100,0b100101000111,0b111111111010,0b000001000001,0b110111011001,0b010011000000,0b101100000101,0b110000100100,0b110100100101,0b101011010010,0b101001000101,0b110001001111,0b010010011010,0b000110110111,0b011010110001,0b001101001001,0b010110101000,0b101000011000,0b110010011010,0b100101011111,0b001101110011,0b110001110001,0b011110000110,0b111011100101,0b001100111001,0b001011011011,0b001011110001,0b010001111101,0b011000101001,0b100100000110,0b011000101111,0b001010110100,0b000100101010,0b111011010110,0b100111000000,0b001000111010,0b101101001111,0b000110111010,0b001111100001,0b011110011001,0b100011000101,0b001010010011,0b110011100110,0b010010001011,0b110101101110,0b111100100101,0b101100100010,0b111010111101,0b000000000011,0b011011001110,0b101110000001,0b000111111000,0b100000110001,0b101101100111,0b001001011001,0b101100010010,0b001000011100,0b111011111100,0b010000100011,0b111010111100,0b011001101111,0b100011001111,0b011001111010,0b110110100101,0b010110100110,0b011110101101,0b011101110001,0b111000100101,0b000010000000,0b100110111001,0b000101000001,0b000001101100,0b011010000100,0b111000101001,0b111100111111,0b100110000110,0b100010001010,0b011110001000,0b100001100100,0b101101101010,0b101111010001,0b010001111100,0b001010111001,0b001101110111,0b010100101100,0b100011011101,0b010100111000,0b000110000000,0b110101101010,0b010100000101,0b101110111100,0b001010110000,0b000000010101,0b000100011000,0b011010110100,0b010000000010,0b111101100011,0b000111101001,0b011101011100,0b101000101101,0b110110101011,0b011010110011,0b011001101010,0b100000000011,0b101001111111,0b111010110100,0b010000011100,0b011011100000,0b110011011000,0b111011101111,0b100010110110,0b010000100111,0b110101110101,0b100010111001,0b011011101000,0b011010000001,0b001001111110,0b100010010001,0b010101000110,0b111111110010,0b101011011110,0b010011110110,0b000010010100,0b100011101111,0b001001110110,0b000100110100,0b100101110110,0b011010111001,0b010010101110,0b110010100011,0b011010101010,0b000101111000,0b111011110011,0b100111101110,0b101111101001,0b010111100010,0b111011001011,0b111110011110,0b110110010110,0b010110010111,0b011111001100,0b110111110010,0b110011111000,0b001110111101,0b111100111000,0b000100000010,0b110101111110,0b010111101101,0b111001001010,0b000010011100,0b110101100100,0b111000011110,0b010110000000,0b011100010011,0b011110010100,0b101000100111,0b111011110101,0b000100010000,0b000110110011,0b100011001011,0b111010100000,0b010100110101,0b001000000101,0b010001101100,0b010110000101,0b100100101111,0b011101111110,0b000011110000,0b000011010011,0b101111111110,0b101001101010,0b000010100011,0b010100101010,0b001111001110,0b011000001001,0b010001110100,0b010111011110,0b100000111111,0b101100010101,0b111101000110,0b110111101111,0b011010010010,0b011100011100,0b001111010010,0b111001101000,0b110110111010,0b101110000111,0b011100101100,0b011100001010,0b110101011101,0b011100010010,0b010101010010,0b000001111101,0b110100110111,0b011111100111,0b111101011110,0b110110000110,0b100110001011,0b111110000001,0b010001010011,0b101001110110,0b011101011101,0b010011011110,0b000100000000,0b100110010001,0b000011100110,0b101111100001,0b101100101010,0b001010101110,0b001111001101,0b110000000111,0b110010100001,0b011100000111,0b100111100111,0b101001011111,0b110000100011,0b111001000111,0b010101111010,0b110111100100,0b001010101100,0b001011110100,0b001010010111,0b110001001000,0b110010011001,0b110111011100,0b001110000011,0b010001000010,0b100000000101,0b110001101001,0b000101010111,0b101010110101,0b100000010000,0b000000111100,0b011011100100,0b110010001110,0b110110100000,0b101100001100,0b110010110111,0b010001100010,0b101110100010,0b001101101101,0b010100110000,0b010010100000,0b011101110100,0b100011011001,0b010110111101,0b010110011011,0b011111011111,0b001000000000,0b001101110101,0b010000010101,0b000101001000,0b011011100101,0b001010000101,0b110010001101,0b000001000011,0b001101001110,0b000101100010,0b010110100001,0b010111110011,0b011000100111,0b100001101011,0b100100100011,0b111100011001,0b010010101000,0b101010000010,0b010011000001,0b100000000010,0b010011101011,0b101110100111,0b111101101011,0b011010001111,0b001000011000,0b011111110111,0b101111011100,0b011011011111,0b110111100010,0b010010110001,0b111100010111,0b111000001111,0b101100010011,0b010101001101,0b110101100001,0b010111010110,0b110000001111,0b000111000000,0b110010010001,0b001110110101,0b101000010010,0b010110001100,0b001101101010,0b110110110110,0b000000000111,0b011010010000,0b011001010111,0b001010101011,0b001001100011,0b001111010110,0b000000100111,0b000000010100,0b001001110011,0b010111000010,0b010000001100,0b101111010111,0b101001110100,0b100011010111,0b000111110100,0b011101111010,0b000111000010,0b011100111100,0b011011110100,0b101000110011,0b010101110111,0b111101101000,0b010010011011,0b000101011111,0b010000000110,0b011110100101,0b111000000100,0b010110110101,0b010110111001,0b101110010000,0b010111001111,0b001001000110,0b010100010000,0b101100100111,0b101100001000,0b110110001001,0b011001001010,0b011001001110,0b110011101001,0b010100101111,0b111101001000,0b100000101100,0b111000011000,0b011000011100,0b111111010001,0b111100100100,0b011000111110,0b010011010000,0b100110101100,0b110000100001,0b001101010011,0b011000101110,0b000110010000,0b011010101100,0b001110001010,0b010101000001,0b101010010101,0b100000010111,0b000100110101,0b110111010110,0b101101101011,0b100101100101,0b101010011110,0b111001000100,0b011101100111,0b010000110101,0b100111010110,0b010011111110,0b111011100100,0b100010101101,0b010110100101,0b100011100000,0b110010011101,0b011110000011,0b111111110011,0b100001101100,0b000000011000,0b000100101101,0b000100110000,0b000110000010,0b011110010011,0b111001111111,0b000011110101,0b111001101100,0b111010111010,0b000101000101,0b111000010110,0b111010011000,0b101110100110,0b111100000100,0b101000110001,0b000001010110,0b101000100000,0b110111001010,0b001001101000,0b010011111010,0b100010100100,0b110010101001,0b111101100101,0b010001000101,0b011001111101,0b110000001110,0b100101101100,0b110110111100,0b010111011101,0b111011011100,0b011111011100,0b100100011001,0b111010011011,0b110011101011,0b100001101000,0b010110100010,0b101100100110,0b010110111010,0b111111011001,0b101011110011,0b011001101001,0b110011100111,0b010100111110,0b001001010011,0b010101110000,0b010111010101,0b100110011100,0b110010011011,0b001011010111,0b000001010100,0b001111011100,0b000010100100,0b010101011011,0b010100001011,0b000001011110,0b011111010111,0b010000101100,0b111111101111,0b100101010110,0b100011010101,0b100101100100,0b010011111101,0b010011001111,0b011010000101,0b110010000111,0b101110110110,0b000010001001,0b111000010010,0b111001001111,0b111000111010,0b010111011100,0b011010001101,0b111011011111,0b001010110001,0b011111111101,0b001001001011,0b100100011000,0b001000101010,0b101001111010,0b011101000010,0b111010000111,0b001000100000,0b100000100010,0b111111011000,0b110011000110,0b111111100010,0b100110011101,0b101111101000,0b001001001100,0b100001100001,0b100111110011,0b001000100010,0b011100011000,0b000001010010,0b100010111110,0b101111010010,0b100100000011,0b000101000010,0b101001011100,0b000101001101,0b000101110010,0b111111111011,0b110100000100,0b000001000010,0b101011010101,0b000011110011,0b000011001000,0b010111111001,0b111110100111,0b100110100111,0b001100001111,0b000100011110,0b001101000101,0b011110000000,0b000100111100,0b011110010111,0b011011010011,0b010101011110,0b100111001100,0b011111101010,0b011011001000,0b100100110100,0b011101010101,0b100101111001,0b100011101001,0b101010000001,0b101110111001,0b110100101111,0b010001001100,0b100110110000,0b100000111001,0b010111011011,0b111110001000,0b101000111101,0b000011010110,0b100010010010,0b010010011111,0b011110111110,0b000100111000,0b111100001101,0b000010110101,0b010010001110,0b101111000100,0b100101111100,0b010100011111,0b110101010010,0b000010111110,0b100001000100,0b001010001010,0b110000111100,0b010000101000,0b111000110110,0b001001101010,0b001101011100,0b001000001100,0b110010011100,0b011111000011,0b111100101101,0b110111010101,0b000010010110,0b111101110111,0b000011010010,0b111110000000,0b001111000101,0b100010111100,0b001011000011,0b010110000010,0b001101111101,0b101011000011,0b100001010010,0b100001010100,0b111100011101,0b010110001101,0b011101101101,0b101010101110,0b110111110100,0b001111001010,0b100010111101,0b011010001001,0b111111001000,0b100010100001,0b111010010110,0b001101000011,0b000011111011,0b110101000100,0b110101111101,0b010010000011,0b110101001111,0b001110111110,0b101111100011,0b011011011100,0b001100100100,0b010011111000,0b101010001111,0b111101010101,0b001110110001,0b101100010100,0b100010001000,0b101110000110,0b001101100001,0b111001000110,0b101110011110,0b100010000110,0b101010111011,0b001010110101,0b001101101110,0b100000101111,0b011001000001,0b010100001110,0b100111101000,0b011000110000,0b110000101111,0b010110111111,0b001110101000,0b111010100010,0b100000110100,0b100100000010,0b101010110011,0b010101000100,0b100100001011,0b000110011011,0b110001000010,0b111111000111,0b010001010010,0b001000011011,0b110010000101,0b111110110111,0b001000111001,0b101111100010,0b101001110010,0b001101101111,0b101001101101,0b001000010011,0b111000011111,0b111111110101,0b101001000001,0b010101101111,0b110100100100,0b001011101011,0b001010111100,0b000111100011,0b010001010100,0b110011000011,0b100111100000,0b001001111001,0b111111100001,0b001001100110,0b001000101001,0b111101011011,0b111000000010,0b100000100111,0b101011100100,0b001010111110,0b100110110100,0b110111100111,0b000110101000,0b011001000111,0b010111000001,0b101111101101,0b000001101101,0b000110100111,0b110001010100,0b111110101111,0b111110110101,0b111000010001,0b101111011010,0b101111110110,0b000000101100,0b010011010010,0b000101010101,0b100110101000,0b000111000011,0b001000010110,0b000111001010,0b000001000111,0b000101000110,0b000100010100,0b001011011101,0b001001111101,0b000000000101,0b000100100101,0b101010001101,0b001010000111,0b110110001110,0b000010011010,0b011001110101,0b111111101011,0b001100001100,0b100111001000,0b011010011000,0b000001101001,0b010001111001,0b001001110100,0b111110111000,0b000010010001,0b111111010011,0b100000011011,0b010110010100,0b010000111000,0b100001110110,0b111101111001,0b110000011010,0b100110101111,0b010001100111,0b100001011100,0b110000010011,0b010100001111,0b110010010110,0b110010111000,0b001011000110,0b101011001101,0b010000000100,0b010010000000,0b010100100101,0b110010100101,0b010101110110,0b101101001101,0b110000110011,0b110011110110,0b111101110110,0b001011111001,0b110101101000,0b101111111100,0b110011111101,0b100001111110,0b011101111000,0b101010000111,0b101110011111,0b101000010101];

  describe("part 1", () => {
    function digitsToBinary(digits: number[]): number {
      return digits.reduce((previous, current, index): number => {
        return previous + (current << index);
      }, 0);
    }
    function calculateGammaRate(lines: number[]): number {
      return digitsToBinary(lines.reduce((state: number[], current: number): number[] => {
        return state.map((value: number, index: number) => ( value + ((current >> index) & 1) ))
      }, [0,0,0,0,0,0,0,0,0,0,0,0])
      .map((value: number) => (value > lines.length / 2) ? 1 : 0));
    }
    function calculateEpsilonRate(gammaRate: number, mask: number): number {
      return gammaRate ^ mask;
    }
    let gamma = calculateGammaRate(example);
    let mask = 0b11111;
    it("calculates gamma rate", () => {
      expect(gamma).to.eql(0b10110);
    })
    it("calculates epsilon rate", () => {
      expect(calculateEpsilonRate(gamma, mask)).to.eql(0b01001);
    })
    function calculatePower(lines: number[], mask: number): number {
      let gamma = calculateGammaRate(lines);
      let epsilon = calculateEpsilonRate(gamma, mask);
      return gamma * epsilon;
    }
    it("calculates power", () => {
      expect(calculatePower(example, mask)).to.eql(198)
    })
    it("calculates answer", () => {
      expect(calculatePower(real, 0b111111111111)).to.eql(3429254)
    })
  })
});
